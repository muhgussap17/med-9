{% extends "core/base.html" %}
{% load static %}

{% block title %}{{ pasien.nama_lengkap }} | Edit{% endblock %}

{% block content %}
<!-- Header -->
<div class="header pb-6">
    <div class="container-fluid">
        <div class="header-body">
            <!-- Breadcrumb -->
            <div class="row align-items-center pt-4 pb-4">
                <div class="col-lg-6 col-7">
                    <h6 class="h2 text-default d-inline-block mb-0">
                        {{ page_title|default:"Judul Halaman" }}
                    </h6>
                    <nav aria-label="breadcrumb" class="d-none d-md-inline-block ml-md-4">
                        <ol class="breadcrumb breadcrumb-links breadcrumb-dark">
                            <li class="breadcrumb-item">
                                <a href="{% url 'dashboard' %}"><i class="fa-solid fa-home text-default"></i></a>
                            </li>
                            {% if breadcrumbs %}
                                {% for item in breadcrumbs %}
                                    {% if forloop.last %}
                                        <li class="breadcrumb-item text-muted active" aria-current="page">{{ item.title }}</li>
                                    {% else %}
                                        <li class="breadcrumb-item">
                                            <a href="{{ item.url }}" class="text-default">{{ item.title }}</a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <li class="breadcrumb-item active" aria-current="page">{{ page_title }}</li>
                            {% endif %}
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Header -->
<!-- Page content -->
<div class="container-fluid mt--6">
    <!-- Form Tambah Pasien -->
    <div class="row">
        <div class="col-12 col-md-9">
            <div class="card">
                <div class="card-body">
                    <form id="formPasien" method="POST" action="">
                        {% csrf_token %}
                        <div class="d-flex align-items-center text-center mt-3 mb-3">
                            <h5 class="mr-3 my-0 font-weight-bold">DATA IDENTITAS</h5>
                            <div class="flex-grow-1 border-top"></div>
                        </div>
                        <!-- Jenis Pasien & No. Asuransi-->
                        <div class="row">
                            <!-- Jenis Pasien -->
                            <div class="col-12 col-md-4">
                                <label class="form-control-label">Jenis Pasien <span class="text-danger">*</span></label>
                                <div class="row mt-3 mx-1">
                                    <div class="col-auto custom-control custom-radio align-items-center">
                                        <input type="radio" name="jenis_pasien" id="umum" value="umum" {% if pasien.jenis_pasien == "umum" %}checked{% endif %} class="custom-control-input" checked onchange="toggleAsuransiInput()">
                                        <label class="custom-control-label" for="umum">Umum</label>
                                    </div>
                                    <div class="col-auto custom-control custom-radio align-items-center">
                                        <input type="radio" name="jenis_pasien" id="bpjs" value="bpjs" {% if pasien.jenis_pasien == "bpjs" %}checked{% endif %} class="custom-control-input" onchange="toggleAsuransiInput()">
                                        <label class="custom-control-label" for="bpjs">BPJS</label>
                                    </div>
                                    <div class="col-auto custom-control custom-radio align-items-center">
                                        <input type="radio" name="jenis_pasien" id="asuransi_lain" value="asuransi_lain" {% if pasien.jenis_pasien == "asuransi_lain" %}checked{% endif %} class="custom-control-input" onchange="toggleAsuransiInput()">
                                        <label class="custom-control-label" for="asuransi_lain">Asuransi Lain</label>
                                    </div>
                                </div>
                            </div>
                            <!-- No. Asuransi -->
                            <div class="col-12 col-md-8">
                                <div class="form-group">
                                    <label for="no_asuransi" class="form-control-label">No. Asuransi <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="no_asuransi" name="no_asuransi" value="{{ pasien.no_asuransi|default_if_none:'' }}" pattern="\d{20}" placeholder="Nomor Asuranasi" maxlength="20" disabled>
                                </div>
                            </div>
                        </div>
                        <!-- Nama Lengkap -->
                        <div class="row">
                            <!-- Nama Lengkap -->
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label for="nama_lengkap" class="form-control-label">Nama Lengkap <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="nama_lengkap" name="nama_lengkap" value="{{ pasien.nama_lengkap }}" placeholder="Masukkan nama lengkap" required>
                                </div>
                            </div>
                        </div>
                        <!-- No. RM & NIK-->
                        <div class="row">
                            <!-- No. RM -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="no_rm" class="form-control-label">No. Rekam Medis <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="no_rm" name="no_rm" value="{{ pasien.no_rm }}" placeholder="Masukkan No. RM" required>
                                </div>
                            </div>
                            <!-- NIK -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="nik" class="form-control-label">NIK <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="nik" name="nik" value="{{ pasien.nik }}" maxlength="16" pattern="\d{16}" placeholder="Masukkan NIK" maxlength="16" required>
                                </div>
                            </div>
                        </div>
                        <!-- Tanggal Lahir & Jenis Kelamin-->
                        <div class="row">
                            <!-- Tanggal Lahir -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="tanggal_lahir" class="form-control-label">Tanggal Lahir <span class="text-danger">*</span></label>
                                    <div class="input-group input-group-merge">
                                        <input type="text" class="form-control datepicker" id="tanggal_lahir" name="tanggal_lahir" value="{{ pasien.tanggal_lahir }}" placeholder="Tanggal Lahir (MM/DD/YYYY)" required autocomplete="off">
                                        <div class="input-group-append">
                                            <span class="input-group-text text-primary">
                                                <i class="fa-solid fa-calendar-days"></i>
                                            </span>
                                        </div> 
                                    </div>
                                </div>
                            </div>
                            <!-- Jenis Kelamin -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="jenis_kelamin" class="form-control-label">Jenis Kelamin <span class="text-danger">*</span></label>
                                    <select class="form-control" id="jenis_kelamin" name="jenis_kelamin" value="{{ form.jenis_kelamin.value }}">
                                        <option value="" disabled selected hidden>Pilih</option>
                                        <option value="l" {% if pasien.jenis_kelamin == "l" %}selected{% endif %}>Laki-laki</option>
                                        <option value="p" {% if pasien.jenis_kelamin == "p" %}selected{% endif %}>Perempuan</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <!-- Status Pasien & Nomor HP -->
                        <div class="row">
                            <!-- Status Pasien -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="status" class="form-control-label">Status <span class="text-danger">*</span></label>
                                    <select class="form-control" id="status" name="status" required>
                                        <option value="aktif" {% if pasien.status == "aktif" %}selected{% endif %}>Aktif</option>
                                        <option value="nonaktif" {% if pasien.status == "nonaktif" %}selected{% endif %}>Tidak Aktif</option>
                                    </select>
                                </div>
                            </div>
                            <!-- Nomor HP -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="nomor_hp" class="form-control-label">Nomor telepon <span class="text-danger">*</span></label>
                                    <div class="input-group input-group-merge">
                                        <input type="tel" class="form-control" id="nomor_hp" name="nomor_hp" value="{{ pasien.nomor_hp|default_if_none:'' }}" pattern="08[0-9]{8,11}" placeholder="Nomor Telepon">
                                        <div class="input-group-append">
                                            <span class="input-group-text text-default">
                                                <i class="fa-solid fa-phone-flip text-muted"></i>
                                            </span>
                                        </div> 
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Alamat -->
                        <div class="row">
                            <!-- Alamat -->
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label for="alamat" class="form-control-label">Alamat Lengkap <span class="text-danger">*</span></label>
                                    <textarea class="form-control" id="alamat" name="alamat" rows="3" placeholder="Alamat">{{ pasien.alamat|default_if_none:'' }}</textarea>
                                </div>
                            </div> 
                        </div>                        
                        <div class="d-flex align-items-center text-center mt-4 mb-3">
                            <h5 class="mr-3 my-0 font-weight-bold">DATA SOSIAL</h5>
                            <div class="flex-grow-1 border-top"></div>
                        </div>
                        <!-- Agama % Pendidikan-->
                        <div class="row">
                            <!-- Agama -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="agama" class="form-control-label">Agama</label>
                                    <select class="form-control" id="agama" name="agama">
                                        <option value="" disabled selected hidden>Pilih</option>
                                        <option value="islam" {% if pasien.agama == "islam" %}selected{% endif %}>Islam</option>
                                        <option value="kristen_protestan" {% if pasien.agama == "kristen_protestan" %}selected{% endif %}>Kristen Protestan</option>
                                        <option value="katolik" {% if pasien.agama == "katolik" %}selected{% endif %}>Katolik</option>
                                        <option value="hindu" {% if pasien.agama == "hindu" %}selected{% endif %}>Hindu</option>
                                        <option value="buddha" {% if pasien.agama == "buddha" %}selected{% endif %}>Buddha</option>
                                        <option value="konghucu" {% if pasien.agama == "konghucu" %}selected{% endif %}>Konghucu</option>
                                        <option value="kepercayaan_lain" {% if pasien.agama == "kepercayaan_lain" %}selected{% endif %}>Kepercayaan Lain</option>
                                    </select>
                                </div>
                            </div>
                            <!-- Pendidikan -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="pendidikan" class="form-control-label">Pendidikan</label>
                                    <select class="form-control" id="pendidikan" name="pendidikan">
                                        <option value="" disabled selected hidden>Pilih</option>
                                        <option value="belum_sekolah" {% if pasien.pendidikan == "belum_sekolah" %}selected{% endif %}>Belum Sekolah</option>
                                        <option value="sd" {% if pasien.pendidikan == "sd" %}selected{% endif %}>SD/Sederajat</option>
                                        <option value="smp" {% if pasien.pendidikan == "smp" %}selected{% endif %}>SMP/Sederajat</option>
                                        <option value="sma" {% if pasien.pendidikan == "sma" %}selected{% endif %}>SMA/Sederajat</option>
                                        <option value="d3" {% if pasien.pendidikan == "d4" %}selected{% endif %}>Diploma 3 (D3)</option>
                                        <option value="s1" {% if pasien.pendidikan == "s1" %}selected{% endif %}>Sarjana (S1)</option>
                                        <option value="s2" {% if pasien.pendidikan == "s2" %}selected{% endif %}>Magister (S2)</option>
                                        <option value="s3" {% if pasien.pendidikan == "s3" %}selected{% endif %}>Doktor (S3)</option>
                                        <option value="lainnya" {% if pasien.pendidikan == "lainnya" %}selected{% endif %}>Lainnya</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <!-- Pekerjaan & Status Pernikahan -->
                        <div class="row">
                            <!-- Pekerjaan -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="pekerjaan" class="form-control-label">Pekerjaan</label>
                                    <select class="form-control" id="pekerjaan" name="pekerjaan">
                                        <option value="" disabled selected hidden>Pilih</option>
                                         <option value="belum_kerja" {% if pasien.pekerjaan == "belum_kerja" %}selected{% endif %}>Belum Bekerja</option>
                                         <option value="pelajar_mahasiswa" {% if pasien.pekerjaan == "pelajar_mahasiswa" %}selected{% endif %}>Pelajar/Mahasiswa</option>
                                         <option value="ibu_rumah_tangga" {% if pasien.pekerjaan == "ibu_rumah_tangga" %}selected{% endif %}>Mengurus Rumah Tangga</option>
                                         <option value="pensiunan" {% if pasien.pekerjaan == "pensiunan" %}selected{% endif %}>Pensiunan</option>
                                         <option value="pns" {% if pasien.pekerjaan == "pns" %}selected{% endif %}>PNS</option>
                                         <option value="tni_polri" {% if pasien.pekerjaan == "tni_polri" %}selected{% endif %}>TNI/Polri</option>
                                         <option value="karyawan_swasta" {% if pasien.pekerjaan == "karyawan_swasta" %}selected{% endif %}>Karyawan Swasta</option>
                                         <option value="karyawan_bumn" {% if pasien.pekerjaan == "karyawan_bumn" %}selected{% endif %}>Karyawan BUMN/BUMD</option>
                                         <option value="pengusaha" {% if pasien.pekerjaan == "pengusaha" %}selected{% endif %}>Pengusaha</option>
                                         <option value="lainnya" {% if pasien.pekerjaan == "lainnya" %}selected{% endif %}>Lainnya</option>
                                     </select>
                                </div>
                            </div>
                            <!-- Status Pernikahan -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="status_pernikahan" class="form-control-label">Status Pernikahan</label>
                                    <select class="form-control" id="status_pernikahan" name="status_pernikahan">
                                        <option value="" disabled selected hidden>Pilih</option>
                                        <option value="belum_nikah" {% if pasien.status_pernikahan == "belum_nikah" %}selected{% endif %}>Belum Nikah</option>
                                        <option value="nikah" {% if pasien.status_pernikahan == "nikah" %}selected{% endif %}>Nikah</option>
                                        <option value="cerai_hidup" {% if pasien.status_pernikahan == "cerai_hidup" %}selected{% endif %}>Cerai Hidup</option>
                                        <option value="cerai_mati" {% if pasien.status_pernikahan == "cerai_mati" %}selected{% endif %}>Cerai Mati</option>
                                        <option value="lainnya" {% if pasien.status_pernikahan == "lainnya" %}selected{% endif %}>Lainnya</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex align-items-center text-center mt-4 mb-3">
                            <h5 class="mr-3 my-0 text-default font-weight-bold">DATA KESEHATAN</h5>
                            <div class="flex-grow-1 border-top"></div>
                        </div>
                        <!-- Status Merokok & Golongan Darah-->
                        <div class="row">
                            <!-- Status Merokok -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="status_merokok" class="form-control-label">Status Merokok</label>
                                    <select class="form-control" id="status_merokok" name="status_merokok">
                                        <option value="" disabled selected hidden>Pilih</option>
                                        <option value="tidak_merokok" {% if pasien.status_merokok == "tidak_merokok" %}selected{% endif %}>Tidak Merokok</option>
                                        <option value="merokok" {% if pasien.status_merokok == "merokok" %}selected{% endif %}>Perokok</option>
                                    </select>
                                </div>
                            </div>
                            <!-- Golongan Darah -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="golongan_darah" class="form-control-label">Golongan Darah</label>
                                    <select class="form-control" id="golongan_darah" name="golongan_darah">
                                        <option value="" disabled selected hidden>Pilih</option>
                                        <option value="a" {% if pasien.golongan_darah == "a" %}selected{% endif %}>A</option>
                                        <option value="b" {% if pasien.golongan_darah == "b" %}selected{% endif %}>B</option>
                                        <option value="ab" {% if pasien.golongan_darah == "ab" %}selected{% endif %}>AB</option>
                                        <option value="o" {% if pasien.golongan_darah == "o" %}selected{% endif %}>O</option>
                                    </select>
                                </div>
                            </div>
                        </div>         
                    </form>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-3">
            <div class="card">
                <div class="card-body">
                    <!-- Tombol Simpan & Batal -->
                    <div class="row">
                        <div class="col-12">
                            <button type="submit" form="formPasien" class="btn btn-primary btn-block">Simpan</button>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-12">
                            <a href="{% url 'daftar_pasien' %}" class="btn btn-outline-primary btn-block">Batal</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Form Tambah Pasien -->
    <!-- Footer -->
    <footer class="footer pt-0">
        <div class="row align-items-center justify-content-lg-between">
            <div class="col-lg-6">
                <div class="copyright text-center text-lg-left text-muted">
                    &copy; 2025 <a href="#" class="font-weight-bold ml-1" target="_blank">Kelompok 9 RPL</a>
                </div>
            </div>
            <div class="col-lg-6">
                <ul class="nav nav-footer justify-content-center justify-content-lg-end">
                    <li class="nav-item">
                        <a href="#" class="nav-link" target="_blank">About Us</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" target="_blank">Blog</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" target="_blank">License</a>
                    </li>
                </ul>
            </div>
        </div>
    </footer>
    <!-- End Footer -->
</div>
<!-- End Page content -->
{% endblock %}

{% block scripts %}
    <!-- Datepicker halaman tambah pasien -->
    <script>
        $(document).ready(function () {
            $('.datepicker').datepicker({
                format: 'mm-dd-yyyy',
                autoclose: true,
                todayHighlight: true
            });
        });
    </script>
    <!-- Script toggle input halmaan tambah pasien-->
    <script>
        function toggleAsuransiInput() {
            const inputAsuransi = document.getElementById('no_asuransi');
            const jenisPasien = document.querySelector('input[name="jenis_pasien"]:checked').value;
    
            // Aktifkan input jika BPJS atau Lain
            inputAsuransi.disabled = !(jenisPasien === 'bpjs' || jenisPasien === 'asuransi_lain');
        }
    
        // Inisialisasi saat halaman dimuat (jika form digunakan kembali)
        document.addEventListener('DOMContentLoaded', toggleAsuransiInput);
    </script>
{% endblock %}
